---
layout:     post
title:      宿舍蓝牙门锁命令详解
subtitle:   让门锁更强大
date:       2016-05-12 13:13:06 +0800
author:     Shao Guoji
header-img: 
catalog:    true
tag:
    - 硬件
    - 单片机
    - 蓝牙门锁开发笔记
---

**本文作为蓝牙门锁串口命令部分的补充，宿舍蓝牙门锁制作教程详见[DIY宿舍蓝牙门锁]({% post_url 2016-05-12-DIY-bluetooth-door %})**

### 串口字符串命令

门锁通过串口与手机通信，没有设计更高级的数据帧协议，而是用最直接的字符串ASCII码的方式传输数据，单片机通过接收到的字符串执行相应的操作。

### 命令格式说明

串口命令在源码开头部分的字符串数组中定义，支持带一个参数。所有命令（包括参数）以星号开始，井号结束。命令与参数之间用一个空格分隔，除此之外命令中任何部分不允许出现空格。（例：设置时间中午十二点半： **\*settime 12-30-00#**）

### 所有命令

| 命令          | 参数                    | 执行结果                         | 
| ------------- | ----------------------- | -------------------------------- |
| unlock        | 无                      | 开锁                             |
| lock          | 无                      | 松锁                             |
| lighton       | 无                      | 点亮LED指示灯                    |
| lightoff      | 无                      | 熄灭LED指示灯                    |
| lightflash    | 无                      | 闪烁LED指示灯                    |
| settime       | hh-mm-ss                | 设置DS1302时间                   |
| gettime       | 无                      | 返回DS1302时间（字符，格式同设置参数）           |
| setremindtime | hh-mm-ss                | 设置关门提醒时间                 |
| getremindtime | 无                      | 返回关门提醒时间（字符，格式同设置参数）         |
| setalarmtime  | hh1-mm1-ss1,hh2-mm2-ss2 | 设置防盗报警时间区间             |
| getalarmtime  | 无                      | 返回防盗报警时间区间（字符，格式同设置参数）     |
| getstate      | 无                      | 返回门状态（数值，0xff:门开 0x00 门关）|
| beepon        | 无                      | 蜂鸣器短鸣一声                   |
| remindon      | 无                      | 开启关门提醒功能                 |
| remindoff     | 无                      | 关闭关门提醒功能                 |
| alarmon       | 无                      | 开启防盗报警功能                 |
| alarmoff      | 无                      | 关闭防盗报警功能                 |
| getremind     | 无                      | 获取关门提醒是否打开（数值，0xff:开 0x00 关） |
| getalarm      | 无                      | 获取防盗报警是否打开（数值，0xff:开 0x00 关） |
| getcount      | 无                      | 获取开门次数（数值，十六位二进制表示，先发高八位后发低八位）
| clearerro     | 无                      | 清零错误次数                     |